{% for application in pillar['applications'] -%}

server {
{% if loop.index == 1%}
    # in case the server is accessed without a valid Host header
    # fall back to the first configured application
{% endif %}
    server_name  {{application.name}} {% if loop.index == 1%}_{% endif %};
    root /var/www/html/;

    access_log /var/log/nginx/{{application.name}}.access.log main;

    location /mapsocial/ {
        proxy_pass http://127.0.0.1:{{application.port}};
    }
    # geoserver
    location /geoserver/ {
        proxy_pass http://127.0.0.1:8080/geoserver/;
        proxy_set_header Host $http_host;
    }
    # mapfish
    location /print-servlet/ {
        proxy_pass http://127.0.0.1:8080/print-servlet/;
        proxy_set_header Host $http_host;
    }
    rewrite  ^/static/maps/.*/appconfig.js$  /assets_{{- application.name -}}/appconfig.js  last;
}
{%- endfor %}
